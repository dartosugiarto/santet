<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logic Extraction: Canvas Mode</title>
    <style>
        :root {
            --bg-canvas: #F5F5F7; /* Warna dasar kanvas */
            --bg-ui: #FFFFFF;
            --text-primary: #1D1D1F;
            --accent-color: #0071E3;
            --border-color: #E5E5EA;
            --shadow-float: 0 8px 32px rgba(0, 0, 0, 0.08);
            --font-stack: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: var(--font-stack);
            background-color: var(--bg-canvas);
            color: var(--text-primary);
            overflow-x: hidden; /* Mencegah scroll horizontal halaman */
        }

        /* --- 1. INFINITE CANVAS AREA --- */
        /* Ini adalah area diagram yang "Bebas" */
        #canvas-container {
            position: relative;
            width: 100vw;   /* Lebar penuh layar */
            height: 80vh;   /* Tinggi 80% dari layar */
            background-image: 
                radial-gradient(#C7C7CC 1px, transparent 1px);
            background-size: 24px 24px; /* Pola titik-titik halus */
            background-color: var(--bg-canvas);
            overflow: auto; /* Scroll jika diagram terlalu besar */
            cursor: grab;
            border-bottom: 1px solid var(--border-color);
        }

        #canvas-container:active {
            cursor: grabbing;
        }

        /* SVG Diagram */
        svg {
            display: block;
            /* Pastikan SVG cukup besar agar node tidak terpotong */
            min-width: 100%; 
            min-height: 100%;
        }

        /* Header Melayang (Floating UI) */
        .floating-header {
            position: absolute;
            top: 24px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            padding: 12px 30px;
            border-radius: 50px;
            box-shadow: var(--shadow-float);
            border: 1px solid rgba(0,0,0,0.05);
            text-align: center;
            z-index: 100;
            pointer-events: none; /* Agar klik tembus ke bawah jika perlu */
        }

        .floating-header h1 { font-size: 18px; margin: 0; }
        .floating-header p { font-size: 12px; margin: 4px 0 0 0; color: #86868B; }

        /* --- 2. NODE STYLES (Modern & Clean) --- */
        .node-rect {
            fill: #FFFFFF;
            stroke: #D2D2D7;
            stroke-width: 2px;
            rx: 12; /* Rounded corners */
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.05));
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        /* Hover Effect pada Node */
        .node-group:hover .node-rect {
            stroke: var(--accent-color);
            transform: translateY(-2px);
            filter: drop-shadow(0 8px 16px rgba(0,113,227,0.2));
        }

        .node-text {
            font-size: 13px;
            font-weight: 500;
            fill: var(--text-primary);
            pointer-events: none;
            font-family: var(--font-stack);
        }

        .edge-path {
            fill: none;
            stroke: #B0B0B5;
            stroke-width: 2px;
            stroke-linecap: round;
        }

        .edge-label-bg { fill: var(--bg-canvas); }
        .edge-label {
            font-size: 10px;
            font-weight: 700;
            fill: var(--accent-color);
            text-transform: uppercase;
        }

        /* --- 3. PANEL BAWAH (Terpisah) --- */
        .details-panel {
            padding: 40px 20px;
            max-width: 1000px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        .info-card {
            background: white;
            padding: 24px;
            border-radius: 16px;
            border: 1px solid var(--border-color);
        }
        
        .full-width { grid-column: span 2; }

        h2 { font-size: 14px; text-transform: uppercase; letter-spacing: 0.05em; color: #86868B; margin-top: 0; }
        pre { background: #F5F5F7; padding: 15px; border-radius: 8px; overflow-x: auto; font-size: 11px; }

    </style>
</head>
<body>

    <div id="canvas-container">
        
        <div class="floating-header">
            <h1>Logic Structure</h1>
            <p>Buta Karena Santet? (Analisis Sistem)</p>
        </div>

        <svg id="logicSvg"></svg>
    </div>

    <div class="details-panel">
        <div class="info-card">
            <h2>Data Structure (JSON)</h2>
            <pre id="jsonDisplay"></pre>
        </div>
        <div class="info-card">
            <h2>Synthesis</h2>
            <p style="font-size: 14px; line-height: 1.6; color: #333;">
                Diagram di atas memisahkan jalur logika antara <strong>Atribusi Mistis</strong> (ketika alat ilmiah tidak ada) dan <strong>Pembuktian Empiris</strong>. Ini menunjukkan bahwa "santet" seringkali adalah <em>placeholder</em> untuk diagnosa medis yang belum teridentifikasi (seperti Kusta atau Hemofilia).
            </p>
        </div>
    </div>

<script>
    // DATA LOGIC
    const logicData = {
        "nodes": [
            {"id": "N0", "label": "START: Phenomenon", "level": 0},
            {"id": "N1", "label": "? Scientific Tools Available", "level": 1, "type": "decision"},
            
            // Kiri
            {"id": "N2", "label": "Mystical Attribution", "level": 2},
            {"id": "N3", "label": "OUTPUT: Santet Idea", "level": 3, "type": "end"},

            // Kanan
            {"id": "N4", "label": "Empirical Investigation", "level": 2},
            
            {"id": "N5", "label": "Bleeding Case", "level": 3},
            {"id": "N6", "label": "Hemophilia", "level": 4, "type": "end"},
            
            {"id": "N7", "label": "Skin Decay Case", "level": 3},
            {"id": "N8", "label": "Leprosy (M. leprae)", "level": 4, "type": "end"},
            
            {"id": "N9", "label": "Supernatural Test", "level": 3},
            {"id": "N10", "label": "CIA Stargate Project", "level": 4},
            {"id": "N11", "label": "Coincidence (Stat)", "level": 5, "type": "end"}
        ],
        "edges": [
            {"from": "N0", "to": "N1"},
            {"from": "N1", "to": "N2", "label": "NO"},
            {"from": "N2", "to": "N3"},
            {"from": "N1", "to": "N4", "label": "YES"},
            {"from": "N4", "to": "N5"}, {"from": "N5", "to": "N6"},
            {"from": "N4", "to": "N7"}, {"from": "N7", "to": "N8"},
            {"from": "N4", "to": "N9"}, {"from": "N9", "to": "N10"},
            {"from": "N10", "to": "N11"}
        ]
    };

    document.getElementById('jsonDisplay').textContent = JSON.stringify(logicData, null, 2);

    // RENDERER LOGIC
    function render() {
        const container = document.getElementById('canvas-container');
        const svg = document.getElementById('logicSvg');
        
        // Ukuran Kanvas Dinamis
        // Kita set width min 1200 agar diagram tidak gepeng, user bisa scroll
        const width = Math.max(container.offsetWidth, 1200); 
        const height = 600;
        
        svg.style.width = width + "px";
        svg.style.height = height + "px";
        svg.innerHTML = ''; // Reset

        const levelY = 100;
        const startY = 80;
        const nodeW = 160;
        const nodeH = 44;

        // Group by Level
        const levels = {};
        logicData.nodes.forEach(n => {
            if(!levels[n.level]) levels[n.level] = [];
            levels[n.level].push(n);
        });

        const pos = {};

        // Calculate Position
        Object.keys(levels).forEach(lvl => {
            const nodes = levels[lvl];
            const segment = width / (nodes.length + 1);
            nodes.forEach((node, i) => {
                pos[node.id] = {
                    x: segment * (i + 1) - (nodeW/2),
                    y: startY + (node.level * levelY)
                };
            });
        });

        // Draw Edges First (Behind nodes)
        logicData.edges.forEach(e => {
            const s = pos[e.from];
            const t = pos[e.to];
            if(s && t) {
                const sx = s.x + nodeW/2;
                const sy = s.y + nodeH;
                const tx = t.x + nodeW/2;
                const ty = t.y;

                // Bezier
                const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                const cY = (ty - sy) / 2;
                path.setAttribute("d", `M ${sx} ${sy} C ${sx} ${sy+cY}, ${tx} ${ty-cY}, ${tx} ${ty}`);
                path.setAttribute("class", "edge-path");
                if(e.label === "NO") path.setAttribute("stroke-dasharray", "4"); // Putus-putus untuk NO
                svg.appendChild(path);

                if(e.label) {
                    const mx = (sx+tx)/2;
                    const my = (sy+ty)/2;
                    
                    // Background Text Label (agar kabel tidak menabrak teks)
                    const bg = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                    bg.setAttribute("x", mx - 15); bg.setAttribute("y", my - 8);
                    bg.setAttribute("width", 30); bg.setAttribute("height", 16);
                    bg.setAttribute("class", "edge-label-bg");
                    svg.appendChild(bg);

                    const txt = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    txt.setAttribute("x", mx); txt.setAttribute("y", my + 4);
                    txt.setAttribute("text-anchor", "middle");
                    txt.setAttribute("class", "edge-label");
                    txt.textContent = e.label;
                    svg.appendChild(txt);
                }
            }
        });

        // Draw Nodes
        logicData.nodes.forEach(n => {
            const p = pos[n.id];
            const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
            g.setAttribute("class", "node-group");
            
            const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
            rect.setAttribute("x", p.x); rect.setAttribute("y", p.y);
            rect.setAttribute("width", nodeW); rect.setAttribute("height", nodeH);
            rect.setAttribute("class", "node-rect");
            // Warna border khusus untuk Start/End
            if(n.type === 'end') rect.style.stroke = "#34C759";
            if(n.type === 'decision') rect.style.strokeDasharray = "4";

            const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
            text.setAttribute("x", p.x + nodeW/2);
            text.setAttribute("y", p.y + nodeH/2 + 5);
            text.setAttribute("text-anchor", "middle");
            text.setAttribute("class", "node-text");
            text.textContent = n.label;

            g.appendChild(rect);
            g.appendChild(text);
            svg.appendChild(g);
        });
    }

    render();
    window.addEventListener('resize', render);

</script>
</body>
</html>
